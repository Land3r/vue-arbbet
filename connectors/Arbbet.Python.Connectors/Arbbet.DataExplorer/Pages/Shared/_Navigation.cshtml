@using Arbbet.DataExplorer.Data
@using Arbbet.AspNet.Helper.Core
@using Arbbet.AspNet.Helper.Navigation
@inject Arbbet.AspNet.Helper.Navigation.SiteNavigationProvider SiteNavigationProvider 
@{
    var siteDefinition = SiteNavigationProvider.GetNavigation();
}

@if (SiteNavigationHelper.ShowFirstSection)
{
    <div class="nav-header">
        @if (!string.IsNullOrEmpty(siteDefinition.Icon))
        {
            <span><i class="@siteDefinition.Icon mr-2"></i>@siteDefinition.Name</span>
            <span></span>
            <!-- TODO: Pourquoi un deuxieme span est necessaire ??-->
        }
        else
        {
            <span>@siteDefinition.Name</span>
        }
    </div>
}
@if (siteDefinition.Childrens != null && siteDefinition.Childrens.Count > 0)
{
    <ul class="navbar-nav flex-column">
        @foreach (PageNavigationDefinition pageLvl1Definition in siteDefinition.Childrens)
        {
            <li class="nav-item @(Context.Request.Path.HasValue && !string.IsNullOrEmpty(@pageLvl1Definition.Path) ? Context.Request.Path.Value.Contains(@pageLvl1Definition.Path) ? "active" : string.Empty : string.Empty)">
                @if (!string.IsNullOrEmpty(pageLvl1Definition.PageUrl))
                {
                    <a class="nav-link" asp-page="@pageLvl1Definition.PageUrl">
                        @if (!string.IsNullOrEmpty(pageLvl1Definition.Icon))
                        {
                            <i class="@pageLvl1Definition.Icon"></i>
                        }
                        <span class="nav-link-text">@pageLvl1Definition.Name</span>
                    </a>
                }
                else
                {
                    <a class="nav-link" href="javascript:void(0);" data-toggle="collapse" data-target="#@(pageLvl1Definition.Name)_drp">
                        @if (!string.IsNullOrEmpty(pageLvl1Definition.Icon))
                        {
                            <i class="@pageLvl1Definition.Icon"></i>
                        }
                        <span class="nav-link-text">@pageLvl1Definition.Name</span>
                    </a>
                    if (pageLvl1Definition.Childrens != null && pageLvl1Definition.Childrens.Count > 0)
                    {
                        <ul id="@(pageLvl1Definition.Name)_drp" class="nav flex-column collapse collapse-level-1">
                            <li class="nav-item">
                                <ul class="nav flex-column">
                                    @foreach (PageNavigationDefinition pageLvl2Definition in pageLvl1Definition.Childrens)
                                    {
                                        <li class="nav-item">
                                            @if (!string.IsNullOrEmpty(pageLvl2Definition.PageUrl))
                                            {
                                                <a class="nav-link" asp-page="@pageLvl2Definition.PageUrl">
                                                    @if (!string.IsNullOrEmpty(pageLvl2Definition.Icon))
                                                    {
                                                        <i class="@pageLvl2Definition.Icon"></i>
                                                    }
                                                    <span class="nav-link-text">@pageLvl2Definition.Name</span>
                                                </a>
                                            }
                                            else
                                            {
                                                <a class="nav-link" href="javascript:void(0);" data-toggle="collapse" data-target="#@(pageLvl2Definition.Name)_drp">
                                                    @if (!string.IsNullOrEmpty(pageLvl2Definition.Icon))
                                                    {
                                                        <i class="@pageLvl2Definition.Icon"></i>
                                                    }
                                                    <span class="nav-link-text">@pageLvl2Definition.Name</span>
                                                </a>
                                            }
                                        </li>
                                    }
                                </ul>
                            </li>
                        </ul>
                    }
                }
            </li>
        }
    </ul>
}